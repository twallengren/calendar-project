#!/bin/bash
# Pre-commit hook to run spotlessApply on staged Java files

# Get the list of staged Java files
STAGED_JAVA_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.java$')

if [ -n "$STAGED_JAVA_FILES" ]; then
    echo "Running spotlessApply on staged Java files..."

    # Run spotlessApply
    ./gradlew :tools:spotlessApply --quiet

    if [ $? -ne 0 ]; then
        echo "spotlessApply failed. Please fix formatting issues."
        exit 1
    fi

    # Re-add the formatted files to staging
    for file in $STAGED_JAVA_FILES; do
        if [ -f "$file" ]; then
            git add "$file"
        fi
    done

    echo "Formatting applied successfully."
fi

exit 0
